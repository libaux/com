import{P as e,a2 as a,j as t,k as s,o,c as i,w as n,e as l,f as c,n as r,q as u,i as p,aa as d,z as h,l as m,u as g,ad as f}from"./index-9d542c38.js";import{_ as b}from"./uni-easyinput.805e297c.js";import{m as w,_ as C,a as _}from"./login-page.mixin.368214c0.js";import{_ as y}from"./uni-icons.0f08574e.js";import{_ as x}from"./plugin-vueexport-helper.1b428a4d.js";import{_ as v}from"./uni-id-pages-agreements.3f203b65.js";import{_ as V}from"./uni-id-pages-fab-login.73df70d3.js";import"./uni-popup.8a79102a.js";const k=x({props:{modelValue:String,value:String,scene:{type:String,default:()=>""},focus:{type:Boolean,default:()=>!1}},computed:{val:{get(){return this.value||this.modelValue},set(e){this.$emit("update:modelValue",e)}}},data:()=>({focusCaptchaInput:!1,captchaBase64:"",loging:!1}),watch:{scene:{handler(a){a?this.getImageCaptcha(this.focus):e({title:"scene不能为空",icon:"none"})},immediate:!0}},methods:{getImageCaptcha(t=!0){this.loging=!0,t&&(this.val="",this.focusCaptchaInput=!0);a.importObject("uni-captcha-co",{customUI:!0}).getImageCaptcha({scene:this.scene}).then((e=>{this.captchaBase64=e.captchaBase64})).catch((a=>{e({title:a.message,icon:"none"})})).finally((e=>{this.loging=!1}))}}},[["render",function(e,a,h,m,g,f){const b=t(s("uni-icons"),y),w=u,C=p,_=d;return o(),i(C,{class:"captcha-box"},{default:n((()=>[l(C,{class:"captcha-img-box"},{default:n((()=>[g.loging?(o(),i(b,{key:0,class:"loding",size:"20px",color:"#BBB",type:"spinner-cycle"})):c("",!0),l(w,{class:r(["captcha-img",{opacity:g.loging}]),onClick:f.getImageCaptcha,src:g.captchaBase64,mode:"widthFix"},null,8,["class","onClick","src"])])),_:1}),l(_,{onBlur:a[0]||(a[0]=e=>g.focusCaptchaInput=!1),focus:g.focusCaptchaInput,type:"text",class:"captcha",inputBorder:!1,maxlength:"4",modelValue:f.val,"onUpdate:modelValue":a[1]||(a[1]=e=>f.val=e),placeholder:"请输入验证码"},null,8,["focus","modelValue"])])),_:1})}],["__scopeId","data-v-57703449"]]),B=a.importObject("uni-id-co",{errorOptions:{type:"toast"}});const I=x({mixins:[w],data:()=>({mobile:"",password:"",captcha:"",needCaptcha:!1,focusMobile:!1,focusPassword:!1,logo:"/static/logo.png"}),onShow(){document.onkeydown=e=>{var a=e||window.event;a&&13==a.keyCode&&this.pwdLogin()}},methods:{toRetrievePwd(){let e="/pages/login/retrieve/retrieve";/^1\d{10}$/.test(this.mobile)&&(e+=`?phoneNumber=${this.mobile}`),h({url:e,animationType:"slide-in-right",animationDuration:200})},pwdLogin(){if(!this.password.length)return this.focusPassword=!0,e({title:"请输入密码",icon:"none",duration:2e3});if(/^\d+$/.test(this.mobile)&&11!=this.mobile.length)return this.focusMobile=!0,e({title:"请输入有效的手机号",icon:"none",duration:2e3});if(this.needCaptcha&&4!=this.captcha.length)return this.$refs.captcha.getImageCaptcha(),e({title:"请输入验证码",icon:"none",duration:2e3});if(this.needAgreements&&!this.agree)return this.$refs.agreements.popup(this.pwdLogin);let a={password:this.password,captcha:this.captcha};/^1\d{10}$/.test(this.mobile)?a.mobile=this.mobile:a.username=this.mobile,B.login(a).then((e=>{this.loginSuccess(e)})).catch((e=>{"uni-id-captcha-required"==e.errCode?this.needCaptcha=!0:this.needCaptcha&&this.$refs.captcha.getImageCaptcha()}))},toRegister(){h({url:"/pages/login/register/register",animationType:"slide-in-right",animationDuration:200,fail(e){console.error(e)}})}}},[["render",function(e,a,r,d,h,w){const y=u,x=p,B=g,I=t(s("uni-easyinput"),b),j=t(s("uni-forms-item"),C),$=t(s("uni-forms"),_),P=t(s("uni-captcha"),k),S=t(s("uni-id-pages-agreements"),v),L=f,U=t(s("uni-id-pages-fab-login"),V);return o(),i(x,{class:"uni-content"},{default:n((()=>[l(x,{class:"login-logo"},{default:n((()=>[l(y,{src:h.logo},null,8,["src"])])),_:1}),l(B,{class:"title title-box"},{default:n((()=>[m("账号密码登录")])),_:1}),l($,null,{default:n((()=>[l(j,{name:"mobile"},{default:n((()=>[l(I,{focus:h.focusMobile,maxlength:"11",onBlur:a[0]||(a[0]=e=>h.focusMobile=!1),class:"input-box",inputBorder:!1,modelValue:h.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>h.mobile=e),placeholder:"请输入手机号",clearSize:"20"},null,8,["focus","modelValue"])])),_:1}),l(j,{name:"password"},{default:n((()=>[l(I,{focus:h.focusPassword,maxlength:"24",onBlur:a[2]||(a[2]=e=>h.focusPassword=!1),class:"input-box",clearable:"",type:"password",inputBorder:!1,modelValue:h.password,"onUpdate:modelValue":a[3]||(a[3]=e=>h.password=e),placeholder:"请输入密码"},null,8,["focus","modelValue"])])),_:1})])),_:1}),h.needCaptcha?(o(),i(P,{key:0,focus:"",ref:"captcha",scene:"login-by-pwd",modelValue:h.captcha,"onUpdate:modelValue":a[4]||(a[4]=e=>h.captcha=e)},null,8,["modelValue"])):c("",!0),l(S,{scope:"login",ref:"agreements"},null,512),l(L,{class:"uni-btn",type:"primary",onClick:w.pwdLogin},{default:n((()=>[m("登录")])),_:1},8,["onClick"]),l(x,{class:"link-box"},{default:n((()=>[l(B,{class:"forget"},{default:n((()=>[m("忘记了？")])),_:1}),l(x,null,{default:n((()=>[l(B,{class:"link",onClick:w.toRetrievePwd},{default:n((()=>[m("找回密码")])),_:1},8,["onClick"])])),_:1})])),_:1}),l(U,{ref:"uniFabLogin"},null,512)])),_:1})}],["__scopeId","data-v-6cb895bf"]]);export{I as default};
